<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitoring Teknisi - WA Integrated</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #f0f4f8; display: flex; justify-content: center; padding: 20px; }
        .container { width: 100%; max-width: 550px; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        header { text-align: center; margin-bottom: 20px; }
        .progress-section { margin-bottom: 20px; background: #fff; padding: 10px; border-radius: 10px; border: 1px solid #eee; }
        .progress-bar { background: #ecf0f1; height: 12px; border-radius: 10px; overflow: hidden; margin-top: 5px; }
        #progressFill { background: #27ae60; height: 100%; width: 0%; transition: width 0.4s ease; }
        .input-card { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; background: #f8f9fa; padding: 15px; border-radius: 10px; }
        input { padding: 12px; border: 1px solid #ddd; border-radius: 8px; outline: none; }
        .row { display: flex; gap: 10px; }
        .row input { flex: 1; }
        button { cursor: pointer; font-weight: bold; transition: 0.3s; border: none; border-radius: 8px; }
        #addBtn { background: #2c3e50; color: white; padding: 12px; }
        #waBtn { background: #25D366; color: white; padding: 12px; width: 100%; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        ul { list-style: none; }
        li { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #f1f1f1; }
        .task-info { display: flex; flex-direction: column; }
        .task-name { font-weight: bold; }
        .task-worker { font-size: 0.85rem; color: #3498db; }
        .status-btn { padding: 6px 12px; border-radius: 20px; font-size: 0.7rem; color: white; min-width: 90px; }
        .todo { background: #f39c12; } .doing { background: #3498db; } .done { background: #27ae60; }
    </style>
</head>
<body>
<div class="container mt-3">
    <a href="index.html" class="btn btn-dark shadow-sm" style="border-radius: 10px; font-weight: bold;">
        <i class="fas fa-arrow-left"></i> ‚Üê KEMBALI KE MENU UTAMA
    </a>
</div>

<div class="container">
    <header>
        <h1>Monitoring Teknisi</h1>
        <p>Laporan Progres Harian</p>
    </header>

    <div class="progress-section">
        <div style="display:flex; justify-content:space-between; font-size:0.85rem; font-weight:bold;">
            <span>Total Progres</span>
            <span id="progressPercent">0%</span>
        </div>
        <div class="progress-bar"><div id="progressFill"></div></div>
    </div>

    <div class="input-card">
        <input type="text" id="taskInput" placeholder="Jenis Pekerjaan">
        <div class="row">
            <input type="text" id="workerInput" placeholder="Nama Teknisi">
            <input type="date" id="dateInput">
        </div>
        <button onclick="addTask()" id="addBtn">Tambah Jadwal</button>
    </div>

    <ul id="taskList"></ul>

    <button onclick="sendToWA()" id="waBtn">
        <span>Kirim Laporan ke WhatsApp Group</span>
    </button>
</div>

<script>
    let tasks = JSON.parse(localStorage.getItem('myTechSchedule')) || [];
    window.onload = render;

    function addTask() {
        const t = document.getElementById('taskInput'), w = document.getElementById('workerInput'), d = document.getElementById('dateInput');
        if (!t.value || !w.value || !d.value) return alert("Isi semua data!");
        tasks.push({ id: Date.now(), text: t.value, worker: w.value, deadline: d.value, status: 'todo' });
        saveAndRender();
        t.value = ''; w.value = ''; d.value = '';
    }

    function saveAndRender() {
        localStorage.setItem('myTechSchedule', JSON.stringify(tasks));
        render();
    }

    function render() {
        const list = document.getElementById('taskList');
        list.innerHTML = '';
        tasks.forEach(task => {
            const li = document.createElement('li');
            li.innerHTML = `<div class="task-info">
                <span class="task-name">${task.text}</span>
                <span class="task-worker">üõ†Ô∏è Teknisi: ${task.worker}</span>
                <small>üìÖ ${task.deadline}</small>
            </div>
            <button class="status-btn ${task.status}" onclick="updateStatus(${task.id})">${task.status.toUpperCase()}</button>`;
            list.appendChild(li);
        });
        updateProgress();
    }

    function updateStatus(id) {
        const task = tasks.find(t => t.id === id);
        const cycle = ['todo', 'doing', 'done'];
        task.status = cycle[(cycle.indexOf(task.status) + 1) % 3];
        saveAndRender();
    }

    function updateProgress() {
        const completed = tasks.filter(t => t.status === 'done').length;
        const percent = tasks.length ? Math.round((completed / tasks.length) * 100) : 0;
        document.getElementById('progressFill').style.width = percent + '%';
        document.getElementById('progressPercent').innerText = percent + '%';
    }

    function sendToWA() {
        if (tasks.length === 0) return alert("Belum ada tugas untuk dilaporkan!");
        
        let message = "*LAPORAN PROGRES HARIAN TEKNISI*\n";
        message += "--------------------------------------\n";
        
        tasks.forEach((t, i) => {
            let s = t.status === 'done' ? "‚úÖ SELESAI" : t.status === 'doing' ? "‚è≥ PROSES" : "‚ùå TODO";
            message += `${i+1}. *${t.text}*\n   Teknisi: ${t.worker}\n   Status: ${s}\n\n`;
        });

        const progress = document.getElementById('progressPercent').innerText;
        message += `--------------------------------------\n*TOTAL PROGRES: ${progress}*`;

        // Membuka WhatsApp (Ini akan membuka daftar chat, Anda tinggal pilih grupnya)
        const url = "https://wa.me/?text=" + encodeURIComponent(message);
        window.open(url, '_blank');
    }
</script>

</body>
</html>
